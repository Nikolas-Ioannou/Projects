# Εργασία
Δικτυακό Σύστηµα Συγχρονισµού Αρχείων (NetworkFile System - NFS).

# Πώς τρέχουμε το πρόγραμμα
Αρχικά, εκτελούμε την εντολή:
make
Στη συνέχεια, για να τρέξουμε το συνολικό πρόγραμμα, ανοίγουμε δύο τερματικά ή κάνουμε split το τρέχον terminal.
Στο πρώτο τερματικό, εκτελούμε την εντολή:
./fss_manager -l <manager_logfile> -c <config_file> -n <worker_limit>
Στο δεύτερο τερματικό, εκτελούμε την εντολή:
./fss_console -l <console_logfile>
Σημαντικό: Να εκτελεστεί πρώτα ο fss_manager και μετά ο fss_console.

# fss_console
Στο fss_console δίνονται οι εντολές που θέλει να εκτελέσει ο χρήστης. Πιο συγκεκριμένα, οι διαθέσιμες εντολές είναι οι εξής:
   - add <source> <target>: Προσθέτει ένα νέο ζεύγος καταλόγων για συγχρονισμό.
   - status <directory>: Επιστρέφει πληροφορίες για την κατάσταση συγχρονισμού ενός καταλόγου.
   - cancel <source>: Ακυρώνει την παρακολούθηση του καταλόγου <source>.
   - sync <directory>: Εκκινεί άμεσα τον συγχρονισμό για έναν συγκεκριμένο κατάλογο.
   - shutdown: Σταματά τη λειτουργία του διαχειριστή και των εργαζομένων και κλείνει το fss_console, καθώς και το fss_manager.
Αυτές οι εντολές δίνονται στον fss_manager μέσω του pipe fss_in. Όταν τις λάβει και τις εκτελέσει, επιστρέφει κάποια δεδομένα μέσω του pipe fss_out, τα οποία εμφανίζονται στο τερματικό του fss_console και άλλα αποθηκεύονται στο logfile. Αν, κατά την εκτέλεση της εντολής, δεν υπάρχει διαθέσιμος worker, τότε η εντολή μπαίνει σε Queue. Αφού ολοκληρωθεί η εντολή shutdown, τα pipes διαγράφονται απο αυτό το αρχείο.

# Worker
Το πρόγραμμα worker εκτελεί τις απαραίτητες τροποποιήσεις στους καταλόγους. Συγκεκριμένα, πραγματοποιεί τις εντολές:
    - FULL: Εκτελεί πλήρη συγχρονισμό μεταξύ των δύο καταλόγων.
    - ADDED: Προσθέτει ένα αρχείο στο καθορισμένο target directory.
    - MODIFIED: Τροποποιεί ένα υπάρχον αρχείο στο target directory.
    - DELETED: Διαγράφει ένα αρχείο που βρίσκεται στο target directory.
Με την ολοκλήρωση της επιλεγμένης διαδικασίας, το πρόγραμμα εμφανίζει την αναφορά εκτέλεσης exec_report. Η αναφορά αυτή εμφανίζεται είτε στο pipe, εάν έχει οριστεί ως έξοδος, είτε στο terminal και περιλαμβάνει διάφορες πληροφορίες σχετικά με τη διαδικασία που εκτελέστηκε. Αναλυτικά, η αναφορά περιλαμβάνει την επιτυχία ή αποτυχία της εκτέλεσης της εντολής, τον αριθμό των αρχείων που τροποποιήθηκαν σύμφωνα με την εντολή που εκτελέστηκε, καθώς και τυχόν σφάλματα που ενδέχεται να προέκυψαν κατά τη διάρκεια της εκτέλεσης.


# fss_manager
Ο fss_manager αποτελεί τον συντονιστή των δύο προηγούμενων προγραμμάτων. Στην αρχή, κάνει initialize διάφορες λειτουργίες, οι οποίες είναι οι εξής:
    -Αρχικά, λαμβάνει από το compile τα ορίσματα, τα οποία είναι: το logfile, το config_file και ο αριθμός των διαθέσιμων worker διεργασιών.
    -Δημιουργεί τα pipes fss_in και fss_out και τα ανοίγει.
    -Δημιουργεί το σήμα SIGCHLD για τη διαχείριση τερματισμένων διεργασιών.
    -Κάνει initialize την inotify για την παρακολούθηση αλλαγών στο σύστημα αρχείων.
    -Διαβάζει και αποθηκεύει τα ορίσματα στη δομή infoargs.
    -Δημιουργεί τη δομή running_workers, η οποία διευκολύνει την επικοινωνία manager, worker μέσω των pipes.
    -Διαβάζει το config_file και αποθηκεύει τις πληροφορίες στη μνήμη, στη δομή sync_info_mem_store, η οποία οργανώνεται ως λίστα.
    -Δημιουργεί το poll, μέσω του οποίου διαχειρίζεται πολλαπλές πηγές εισόδου.
    -Δημιουργεί έναν πίνακα τον ExitedPIDS όπου ελέγχει ποιοι Worker Process έχουν τελειώσει.
Στη συνέχεια, γίνεται το κύριο loop, στο οποίο πραγματοποιείται το διάβασμα και η δημιουργία των worker processes.Αρχικά,ελέγχεται αν έχει τελειώσει κάποιος Worker.Αν έχει τελειώσει κάποιος τότε διαβάζεται αυτό που επέστρεψε, δηλαδή το exec_report και μέσο της συνάρτησης read_report τυπώνονται και γράφονται τα κατάλληλα μηνύματα.Μετά, ελέγχεται αν υπάρχουν διαθέσιμες εντολές στην queue και αν μπορεί να τις εκτελέσει άμεσα, βάση του πλήθους των workers.Εάν δεν υπάρχουν εντολές στην queue ή δεν είναι δυνατόν να εκτελεστούν, το σύστημα ελέγχει την προέλευση του νέου input, το οποίο μπορεί να προέρχεται είτε από το inotify είτε από το console.Εάν δεν υπάρχουν inputs, τότε το σύστημα προχωρά σε πλήρη συγχρονισμό (full sync) για το επόμενο ζευγάρι directories από το config_file. Αν υπάρχει νέο input, το σύστημα εξετάζει την προέλευση του και εκτελεί τις κατάλληλες λειτουργίες. Συγκεκριμένα:
    -Αν το input προέρχεται από τον χρήστη μέσω του console, τότε το σύστημα διαβάζει τις εντολές από το pipe fss_in και τις εκτελεί.
    -Αν ανιχνευθεί αλλαγή μέσω του inotify, τότε, ανάλογα με το event, το σύστημα αποφασίζει ποια εντολή (ADDED, MODIFIED, DELETED) πρέπει να εκτελέσει.
Το κύριο loop ολοκληρώνεται όταν δοθεί η εντολή shutdown από το console. Σε αυτή την περίπτωση, εκτελούνται όλες οι εκκρεμείς εντολές στην queue και πραγματοποιείται πλήρης συγχρονισμός (full sync) όλων των αρχείων που έχουν μείνει στο config_file.

# Τρόπος λειτουργίας ενός operation
Για να εκτελεστεί οποιαδήποτε διαδικασία (FULL SYNC, ADDED, MODIFIED, DELETED), πρέπει να υπάρχει διαθέσιμος worker, δηλαδή η μεταβλητή totalprocess να είναι μικρότερη από τον αριθμό των workers που έχει οριστεί. Αν δεν υπάρχει διαθέσιμος worker, τότε η εντολή τοποθετείται σε queue.Αλλιώς αν, υπάρχει διαθέσιμος worker, τότε ο manager κάνει fork για να δημιουργήσει νέα worker processes. Στη συνέχεια, ο manager ορίζει μια μεταβλητή running_worker και μετά γράφει στο pipe της μεταβλητής τα directories και την εντολή που πρέπει να εκτελέσει ο worker, τα οποία τα λαμβάνει. Ο worker, πριν εκτελέσει το worker.c μέσω exec, κάνει redirect το output του στο pipe του running_workers ώστε να σταλεί πίσω στον manager. Στο τέλος της εκτέλεσης του, ο worker στέλνει το σήμα SIGCHLD στον manager και αυτόματα πηγαίνει στη συνάρτηση sigchld_handler.Στην συνάρτηση αυτή ορίζεται ότι τελείωσε ο worker στην μεταβλητή ExitedPIDS.Στο τέλος όταν φτάσει στην αρχή του loop ο maanager καλείτε η read_report, η οποία θα αναλύσει το exec_report που επέστρεψε ο worker και μπορεί να εμφανίσει τα κατάλληλα μηνύματα,να γράψει στο logfile που του ορίστηκε και να στείλει μηνύματα στο fss_console,ανάλογα με την εντολή που έκανε.

# Σημείωση fss_script.sh
Στο Bash script δεν έχουν υλοποιηθεί οι εντολές listMonitored και listStopped.

